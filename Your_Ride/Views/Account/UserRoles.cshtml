@model Your_Ride.ViewModels.Account.UserRolesVM

<h2 class="text-center">User & Role Management</h2>
        <hr style="margin-bottom:10px" />

<div class="row" style="margin-bottom:15px ; padding-block:10px">
    <!-- User Management -->
    <div class="col-lg-8">
        <h4 class="text-center"><i class="fas fa-users"></i> Users & Their Roles</h4>

        <!-- Search Bar -->
        <div class="d-flex justify-content-center mb-3">
            <form asp-action="UserRoles" method="get" class="d-flex search-form">
                <input type="text" name="search" class="form-control me-2 w-100"
                       placeholder="Search by username or email" value="@Context.Request.Query["search"]">
                <button type="submit" class="btn btn-primary">
                    <i class="fas fa-search"></i> Search
                </button>
            </form>
        </div>
        <hr />
        <!-- User Cards -->
        <div class="user-cards-container">
            @foreach (var user in Model.Users)
            {
                <div class="user-card">
                    <img src="@(string.IsNullOrEmpty(user.UserImg) ? "/img/default-profile.png" : user.UserImg)"
                         alt="Profile Picture" class="user-img">
                    <h5 class="user-name">@user.UserName</h5>
                    <p class="user-email">@user.Email</p>
                    <p class="user-roles">
                        <strong>Roles:</strong> @string.Join(", ", user.Roles)
                    </p>

                    <div class="user-actions">
                        <!-- Assign Role -->
                        <form asp-action="AssignRole" asp-controller="Account" method="post" class="role-form assign-role">
                            <input type="hidden" name="userId" value="@user.UserId" />
                            <select name="role" class="form-select role-select">
                                @foreach (var role in Model.Roles)
                                {
                                    <option value="@role">@role</option>
                                }
                            </select>
                            <button type="submit" class="btn assign-btn">
                                <i class="fas fa-user-plus"></i> Assign
                            </button>
                        </form>

                        <!-- Remove Role -->
                        <form asp-action="RemoveRole" asp-controller="Account" method="post" class="role-form remove-role">
                            <input type="hidden" name="userId" value="@user.UserId" />
                            <select name="role" class="form-select role-select">
                                @foreach (var role in user.Roles)
                                {
                                    <option value="@role">@role</option>
                                }
                            </select>
                            <button type="submit" class="btn remove-btn">
                                <i class="fas fa-user-minus"></i> Remove
                            </button>
                        </form>
                    </div>
                </div>
            }
        </div>
    </div>

    <!-- Role Management -->
    <div class="col-lg-4">
        <h4 class="text-center"><i class="fas fa-user-shield"></i> Role Management</h4>

        <table class="table table-hover text-center">
            <thead class="table-dark">
                <tr>
                    <th>Role Name <i class="fas fa-user-tag"></i></th>
                    <th>Actions <i class="fas fa-tools"></i></th>
                </tr>
            </thead>
            <tbody>
                @foreach (var role in Model.Roles)
                {
                    <tr>
                        <td>@role</td>
                        <td>
                            <a asp-action="EditRole" asp-route-roleName="@role" class="btn btn-warning">
                                <i class="fas fa-edit"></i> Edit
                            </a>
                            <form asp-action="DeleteRole" asp-controller="Account" method="post" class="d-inline">
                                <input type="hidden" name="roleName" value="@role" />
                                <button type="submit" class="delete-button">
                                    <svg class="delete-svgIcon" viewBox="0 0 448 512">
                                        <path d="M135.2 17.7L128 32H32C14.3 32 0 46.3 0 64S14.3 96 32 96H416c17.7 0 32-14.3 32-32s-14.3-32-32-32H320l-7.2-14.3C307.4 6.8 296.3 0 284.2 0H163.8c-12.1 0-23.2 6.8-28.6 17.7zM416 128H32L53.2 467c1.6 25.3 22.6 45 47.9 45H346.9c25.3 0 46.3-19.7 47.9-45L416 128z"></path>
                                    </svg>
                                </button>
                            </form>
                        </td>
                    </tr>
                }
            </tbody>
        </table>

        <a asp-action="AddRole" asp-controller="Account" class="btn btn-primary d-block mx-auto">
            <i class="fas fa-plus-circle"></i> Add New Role
        </a>
    </div>
</div>

@section Scripts {
    <partial name="_ValidationScriptsPartial" />
}

<!-- Styles -->
<style>
    /* Layout */
    .search-form {
        width: 40%;
    }

    .user-cards-container {
        display: flex;
        flex-wrap: wrap;
        justify-content: center;
        gap: 15px;
    }

    .user-card {
        background: #f8f9fa;
        border-radius: 10px;
        padding: 15px;
        text-align: center;
        box-shadow: 0px 4px 8px rgba(0, 0, 0, 0.1);
        width: 250px;
    }

    .user-img {
        width: 80px;
        height: 80px;
        border-radius: 50%;
        object-fit: cover;
        margin-bottom: 10px;
        border: 2px solid #007bff;
    }

    .user-name {
        font-size: 1.2rem;
        font-weight: bold;
        color: #007bff;
    }

    .user-email {
        font-size: 0.9rem;
        color: #555;
    }

    /* Assign & Remove Role Forms */
    .assign-role {
        background-color: #d4edda;
        padding: 2px;
        border-radius: 1px;
        margin-bottom:10px;
    }

    .remove-role {
        background-color: #f8d7da;
        padding: 2px;
        border-radius: 1px;
        margin-bottom: 10px;
    }

    .assign-btn {
        background-color: #28a745;
        color: white;
    }

    .remove-btn {
        background-color: #dc3545;
        color: white;
    }

    /* Delete Button */
    .delete-button {
        width: 40px;
        height: 40px;
        border-radius: 50%;
        background-color: rgb(20, 20, 20);
        border: none;
        font-weight: 600;
        display: flex;
        align-items: center;
        justify-content: center;
        box-shadow: 0px 0px 20px rgba(0, 0, 0, 0.164);
        cursor: pointer;
        transition-duration: 0.3s;
        overflow: hidden;
        position: relative;
    }

    .delete-svgIcon {
        width: 15px;
        transition-duration: 0.3s;
    }

        .delete-svgIcon path {
            fill: white;
        }

    .delete-button:hover {
        width: 90px;
        border-radius: 50px;
        background-color: rgb(255, 69, 69);
    }

        .delete-button:hover .delete-svgIcon {
            width: 20px;
            transform: rotate(360deg);
        }

    .delete-button::before {
        display: none;
        content: "Delete";
        color: white;
        font-size: 2px;
    }

    .delete-button:hover::before {
        display: block;
        padding-right: 10px;
        font-size: 13px;
    }
</style>
