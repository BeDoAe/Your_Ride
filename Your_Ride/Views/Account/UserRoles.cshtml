@model Your_Ride.ViewModels.Account.UserRolesVM

<h2 class="text-center">User & Role Management</h2>
<hr style="margin-bottom:10px" />

<div class="row" style="margin-bottom:15px ; padding-block:10px">
    <!-- User Management -->
    <div class="col-lg-8">
        <h4 class="text-center"><i class="fas fa-users"></i> Users & Their Roles</h4>

        <!-- Search Bar -->
        <div class="d-flex justify-content-center mb-3">
            <form asp-action="UserRoles" method="get" class="d-flex search-form">
                <input type="text" name="search" class="form-control me-2 w-100"
                       placeholder="Search by username or email" value="@Context.Request.Query["search"]">
                <button type="submit" class="btn btn-primary">
                    <i class="fas fa-search"></i> Search
                </button>
            </form>
        </div>
        <hr />

        <!-- User Cards -->
        <div class="user-cards-container">
            @foreach (var user in Model.Users)
            {
                <div class="user-card">
                    <img src="@(string.IsNullOrEmpty(user.UserImg) ? "/img/default-profile.png" : user.UserImg)"
                         alt="Profile Picture" class="user-img">
                    <h5 class="user-name">@user.UserName</h5>
                    <p class="user-email">@user.Email</p>
                    <p class="user-roles">
                        <strong>Roles:</strong> @string.Join(", ", user.Roles)
                    </p>

                    <div class="user-actions">
                                                 <!-- Block/Unblock User -->
                        <form asp-controller="Account" asp-action="@(user.IsLocked ? "UnblockUser" : "BlockUser")" method="post">
                            <input type="hidden" name="userID" value="@user.UserId" />
                            <button type="submit" class="custom-btn @(user.IsLocked ? "unblock-btn" : "block-btn")">
                                <span class="shadow"></span>
                                <span class="edge"></span>
                                <span class="front text">
                                    <i class="fas @(user.IsLocked ? "fa-unlock" : "fa-lock")"></i>
                                    @(user.IsLocked ? "Unblock" : "Block")
                                </span>
                            </button>
                        </form>




                        <!-- Assign Role -->
                        <form asp-action="AssignRole" asp-controller="Account" method="post" class="role-form assign-role">
                            <input type="hidden" name="userId" value="@user.UserId" />
                            <select name="role" class="form-select role-select">
                                @foreach (var role in Model.Roles)
                                {
                                    <option value="@role">@role</option>
                                }
                            </select>
                            <button type="submit" class="btn assign-btn">
                                <i class="fas fa-user-plus"></i> Assign
                            </button>
                        </form>

                        <!-- Remove Role -->
                        <form asp-action="RemoveRole" asp-controller="Account" method="post" class="role-form remove-role">
                            <input type="hidden" name="userId" value="@user.UserId" />
                            <select name="role" class="form-select role-select">
                                @foreach (var role in user.Roles)
                                {
                                    <option value="@role">@role</option>
                                }
                            </select>
                            <button type="submit" class="btn remove-btn">
                                <i class="fas fa-user-minus"></i> Remove
                            </button>
                        </form>
                    </div>
                </div>
            }
        </div>

        <!-- Pagination -->
        <div class="pagination-container text-center mt-4">
            <ul class="pagination justify-content-center">
                @if (Model.Pagination.HasPrevious)
                {
                    <li class="page-item">
                        <a class="page-link" asp-action="UserRoles" asp-route-pageNumber="@(Model.Pagination.PageNumber - 1)" aria-label="Previous">
                            <span aria-hidden="true">&laquo;</span>
                        </a>
                    </li>
                }

                @for (var i = 1; i <= Model.Pagination.TotalPages; i++)
                {
                    <li class="page-item @(i == Model.Pagination.PageNumber ? "active" : "")">
                        <a class="page-link" asp-action="UserRoles" asp-route-pageNumber="@i">@i</a>
                    </li>
                }

                @if (Model.Pagination.HasNext)
                {
                    <li class="page-item">
                        <a class="page-link" asp-action="UserRoles" asp-route-pageNumber="@(Model.Pagination.PageNumber + 1)" aria-label="Next">
                            <span aria-hidden="true">&raquo;</span>
                        </a>
                    </li>
                }
            </ul>
        </div>
    </div>

    <!-- Role Management -->
    <div class="col-lg-4">
        <h4 class="text-center"><i class="fas fa-user-shield"></i> Role Management</h4>

        <table class="table table-hover text-center">
            <thead class="table-dark">
                <tr>
                    <th>Role Name <i class="fas fa-user-tag"></i></th>
                    <th>Actions <i class="fas fa-tools"></i></th>
                </tr>
            </thead>
            <tbody>
                @foreach (var role in Model.Roles)
                {
                    <tr>
                        <td>@role</td>
                        <td>
                            <a asp-action="EditRole" asp-route-roleName="@role" class="btn btn-warning">
                                <i class="fas fa-edit"></i> Edit
                            </a>
                            <form asp-action="DeleteRole" asp-controller="Account" method="post" class="d-inline">
                                <input type="hidden" name="roleName" value="@role" />
                                <button type="submit" class="delete-button">
                                    <svg class="delete-svgIcon" viewBox="0 0 448 512">
                                        <path d="M135.2 17.7L128 32H32C14.3 32 0 46.3 0 64S14.3 96 32 96H416c17.7 0 32-14.3 32-32s-14.3-32-32-32H320l-7.2-14.3C307.4 6.8 296.3 0 284.2 0H163.8c-12.1 0-23.2 6.8-28.6 17.7zM416 128H32L53.2 467c1.6 25.3 22.6 45 47.9 45H346.9c25.3 0 46.3-19.7 47.9-45L416 128z"></path>
                                    </svg>
                                </button>
                            </form>
                        </td>
                    </tr>
                }
            </tbody>
        </table>

        <a asp-action="AddRole" asp-controller="Account" class="btn btn-primary d-block mx-auto">
            <i class="fas fa-plus-circle"></i> Add New Role
        </a>
    </div>
</div>

@section Scripts {
    <partial name="_ValidationScriptsPartial" />
}

<!-- Styles -->
<style>
    /* Layout */
    .search-form {
        width: 40%;
    }

    .user-cards-container {
        display: flex;
        flex-wrap: wrap;
        justify-content: center;
        gap: 15px;
    }

    .user-card {
        background: #f8f9fa;
        border-radius: 10px;
        padding: 15px;
        text-align: center;
        box-shadow: 0px 4px 8px rgba(0, 0, 0, 0.1);
        width: 250px;
    }

    .user-img {
        width: 80px;
        height: 80px;
        border-radius: 50%;
        object-fit: cover;
        margin-bottom: 10px;
        border: 2px solid #007bff;
    }

    .user-name {
        font-size: 1.2rem;
        font-weight: bold;
        color: #007bff;
    }

    .user-email {
        font-size: 0.9rem;
        color: #555;
    }

    /* Assign & Remove Role Forms */
    .assign-role {
        background-color: #d4edda;
        padding: 2px;
        border-radius: 1px;
        margin-bottom: 10px;
    }

    .remove-role {
        background-color: #f8d7da;
        padding: 2px;
        border-radius: 1px;
        margin-bottom: 10px;
    }

    .assign-btn {
        background-color: #28a745;
        color: white;
    }

    .remove-btn {
        background-color: #dc3545;
        color: white;
    }

    /* Delete Button */
    .delete-button {
        width: 40px;
        height: 40px;
        border-radius: 50%;
        background-color: rgb(20, 20, 20);
        border: none;
        font-weight: 600;
        display: flex;
        align-items: center;
        justify-content: center;
        box-shadow: 0px 0px 20px rgba(0, 0, 0, 0.164);
        cursor: pointer;
        transition-duration: 0.3s;
        overflow: hidden;
        position: relative;
    }

    .delete-svgIcon {
        width: 15px;
        transition-duration: 0.3s;
    }

        .delete-svgIcon path {
            fill: white;
        }

    .delete-button:hover {
        width: 90px;
        border-radius: 50px;
        background-color: rgb(255, 69, 69);
    }

        .delete-button:hover .delete-svgIcon {
            width: 20px;
            transform: rotate(360deg);
        }

    .delete-button::before {
        display: none;
        content: "Delete";
        color: white;
        font-size: 2px;
    }

    .delete-button:hover::before {
        display: block;
        padding-right: 10px;
        font-size: 13px;
    }
    /* Block/Unblock Button */
  
    /* Base button styles */
    .custom-btn {
        position: relative;
        border: none;
        background: transparent;
        padding: 0;
        cursor: pointer;
        outline-offset: 4px;
        transition: filter 250ms;
        user-select: none;
        touch-action: manipulation;
        font-size: 1.1rem;
    }

        /* Default blue button */
        .custom-btn .front {
            display: block;
            position: relative;
            padding: 12px 27px;
            border-radius: 12px;
            color: white;
            background: hsl(220deg 90% 55%);
            will-change: transform;
            transform: translateY(-4px);
            transition: transform 600ms cubic-bezier(.3, .7, .4, 1);
        }

        /* Button shadow */
        .custom-btn .shadow {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            border-radius: 12px;
            background: hsl(0deg 0% 0% / 0.25);
            will-change: transform;
            transform: translateY(2px);
            transition: transform 600ms cubic-bezier(.3, .7, .4, 1);
        }

        /* Edge effect */
        .custom-btn .edge {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            border-radius: 12px;
            background: linear-gradient(to left, hsl(220deg 100% 40%) 0%, hsl(220deg 100% 50%) 8%, hsl(220deg 100% 50%) 92%, hsl(220deg 100% 40%) 100%);
        }

        /* Hover effect */
        .custom-btn:hover {
            filter: brightness(110%);
        }

            .custom-btn:hover .front {
                transform: translateY(-6px);
                transition: transform 250ms cubic-bezier(.3, .7, .4, 1.5);
            }

        .custom-btn:active .front {
            transform: translateY(-2px);
            transition: transform 34ms;
        }

        .custom-btn:hover .shadow {
            transform: translateY(4px);
            transition: transform 250ms cubic-bezier(.3, .7, .4, 1.5);
        }

        .custom-btn:active .shadow {
            transform: translateY(1px);
            transition: transform 34ms;
        }

    /* Specific colors for block/unblock states */
    .block-btn .front {
        background: hsl(345deg 100% 47%);
    }

    .block-btn .edge {
        background: linear-gradient(to left, hsl(340deg 100% 16%) 0%, hsl(340deg 100% 32%) 8%, hsl(340deg 100% 32%) 92%, hsl(340deg 100% 16%) 100%);
    }

    .unblock-btn .front {
        background: hsl(140deg 80% 35%);
    }

    .unblock-btn .edge {
        background: linear-gradient(to left, hsl(140deg 100% 20%) 0%, hsl(140deg 100% 40%) 8%, hsl(140deg 100% 40%) 92%, hsl(140deg 100% 20%) 100%);
    }


</style>
