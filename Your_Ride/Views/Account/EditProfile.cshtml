@model Your_Ride.ViewModels.Account.EditProfileViewModel

<!DOCTYPE html>
<html lang="en">
<head>
    <title>Edit Profile</title>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="https://www.w3schools.com/w3css/4/w3.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

    <style>
        html, body, h1, h2, h3, h4, h5, h6 {
            font-family: "Roboto", sans-serif;
        }

        .field-validation-error {
            display: block;
            margin-top: 5px;
            margin-bottom: 10px;
            color: red;
        }

        /* Profile Image Preview */
        #previewSection {
            display: none;
            margin-top: 10px;
            text-align: center;
        }

        /* Image Preview */
        #previewImg {
            width: 100%;
/*             max-width: 150px; /* Ensures it doesn't get too big */
 */            height: 150px;
            max-height: 300px;
            object-fit: cover;
            border: 2px solid #ddd;
            padding: 5px;
            border-radius: 10px;
            display: block;
            margin: 10px auto;
        }



        /* Form Styling */
        .form-group {
            margin-bottom: 15px;
        }

        .w3-container form {
            padding: 15px;
        }

        .w3-card {
            padding: 15px;
            margin-bottom: 20px;
        }

        .field-validation-error {
            display: block; /* Moves validation message to a new line */
            margin-bottom: 10px; /* Adds spacing between validation message and next label */
            color: red; /* Optional: Style validation messages */
        }
    </style>
</head>

<body class="w3-light-grey">
    <div class="w3-content w3-margin-top" style="max-width:1400px;">
        <div class="w3-row-padding">
            <!-- Profile Card -->
            <div class="w3-third">
                <div class="w3-white w3-text-grey w3-card-4">
                    <div class="w3-display-container">
                        <!-- Profile Image -->
                        <img src="@Model.Pic_URL" style="width:100%; height:400px; margin-bottom:15px;" alt="Profile Image">

                        <!-- Profile Name -->
                        <div class="w3-display-container w3-padding" style="text-align: center; margin-top: -50px;">
                            <div class="w3-display-bottomleft w3-container w3-text-black" style="background-color: rgba(255, 255, 255, 0.7); padding: 10px; border-radius: 5px;">
                                <h2>@Model.FirstName @Model.LastName</h2>
                            </div>
                        </div>
                    </div>
                    <br /><br />
                    <div class="w3-container">
                        <p><i class="fa fa-envelope fa-fw w3-margin-right w3-large w3-text-teal"></i>@Model.Email</p>
                        <p><i class="fa fa-phone fa-fw w3-margin-right w3-large w3-text-teal"></i>@Model.PhoneNumber</p>
                        <p><i class="fa fa-user fa-fw w3-margin-right w3-large w3-text-teal"></i>@(Model.gender?.ToString() ?? "N/A")</p>
                        <p><i class="fa fa-calendar fa-fw w3-margin-right w3-large w3-text-teal"></i>@(Model.DateOfBirth?.ToString("yyyy-MM-dd") ?? "N/A")</p>
                        <hr>
                    </div>
                    <div class="w3-container">
                        <div id="previewSection">
                            <label><strong><b>Image Preview</b></strong></label>

                            <img id="previewImg" src="" />
                        </div>
                    </div>
                </div>
            </div>

            <!-- Edit Form -->
            <div class="w3-twothird">
                <div class="w3-container w3-card w3-white">
                    <h2 class="w3-text-grey w3-padding-16">
                        <i class="fa fa-user fa-fw w3-margin-right w3-xxlarge w3-text-teal"></i>Edit Profile
                    </h2>

                    <form asp-action="EditProfile" method="post" enctype="multipart/form-data">
                        <input type="hidden" asp-for="Id" />
                        <input type="hidden" asp-for="Wallet" />
                        <input type="hidden" id="UniversityID" name="UniversityID" value="@Model.UniversityID" />
                        <input type="hidden" id="CollegeID" name="CollegeID" value="@Model.CollegeID" />
                        <input type="hidden" id="Batch" name="Batch" value="@Model.batch" />
                        <div class="w3-row-padding">
                            <div class="w3-half">
                                <label>First Name:</label>
                                <input type="text" asp-for="FirstName" class="w3-input w3-border">
                                <span asp-validation-for="FirstName" class="validation-message"></span>
                            </div>

                            <div class="w3-half">
                                <label>Last Name:</label>
                                <input type="text" asp-for="LastName" class="w3-input w3-border">
                                <span asp-validation-for="LastName" class="validation-message"></span>
                            </div>
                        </div>

                        <div class="w3-row-padding">
                            <div class="w3-half">
                                <label>Email:</label>
                                <input type="email" asp-for="Email" class="w3-input w3-border">
                                <span asp-validation-for="Email" class="validation-message"></span>
                            </div>

                            <div class="w3-half">
                                <label>Phone Number:</label>
                                <input type="text" asp-for="PhoneNumber" class="w3-input w3-border">
                                <span asp-validation-for="PhoneNumber" class="validation-message"></span>
                            </div>
                        </div>

                        <div class="w3-row-padding">
                            <div class="w3-half">
                                <label>National ID:</label>
                                <input type="text" asp-for="NationalID" class="w3-input w3-border">
                                <span asp-validation-for="NationalID" class="validation-message"></span>
                            </div>

                            <div class="w3-half">
                                <label>Birth of Date:</label>
                                <input type="date" asp-for="DateOfBirth" class="w3-input w3-border">
                            </div>
                        </div>

                        <div class="w3-row-padding">
                            <div class="w3-half">
                                <label>Gender:</label>
                                <select asp-for="gender" class="w3-input w3-border">
                                    <option value="">Select Gender</option>
                                    <option value="Male">Male</option>
                                    <option value="Female">Female</option>
                                </select>
                            </div>

                            <div class="w3-half">
                                <label>Profile Image:</label>
                                <input type="file" id="imgUpload" asp-for="ImgFile" class="w3-input w3-border">
                            </div>
                            @* <div hidden id="previewSection">
                                <label hidden><strong><b>Image Preview</b></strong></label>

                                <img hidden id="previewImg" src="" />
                            </div> *@
                        </div>

                        <!-- Education Section -->
                        <h2 class="w3-text-grey w3-padding-16">
                            <i class="fa fa-graduation-cap fa-fw w3-margin-right w3-xxlarge w3-text-teal"></i>Education
                        </h2>

                        <div class="w3-container">
                            <p><strong>University:</strong> @Model.university.Name</p>
                            <p><strong>College:</strong> @Model.college.Name</p>
                            <p><strong>Batch:</strong> @Model.batch</p>
                        </div>

                        <div class="w3-row-padding">
                            <div class="w3-third form-group">
                                <label>Select University:</label>
                                <select id="UniversityDropdown" class="w3-input w3-border">
                                    <option value="">Select University</option>
                                    @foreach (var university in ViewBag.Universities)
                                    {
                                        <option value="@university.Id">@university.Name</option>
                                    }
                                </select>
                            </div>

                            <div class="w3-third form-group">
                                <label>Select College:</label>
                                <select id="CollegeDropdown" class="w3-input w3-border">
                                    <option value="">Select College</option>
                                </select>
                            </div>

                            <div class="w3-third form-group">
                                <label>Select Batch:</label>
                                <select id="BatchDropdown" class="w3-input w3-border">
                                    <option value="">Select Batch</option>
                                </select>
                            </div>
                        </div>

                        <button type="submit" class="w3-button w3-teal w3-margin-bottom">Save Changes</button>
                    </form>
                </div>
            </div>


        </div>
    </div>
    <!-- Include jQuery Validation Scripts -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-validate/1.19.3/jquery.validate.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-validation-unobtrusive/3.2.12/jquery.validate.unobtrusive.min.js"></script>

    @section Scripts {
        <partial name="_ValidationScriptsPartial" />
    }
    <script>
        $(document).ready(function () {
           // Update hidden inputs when selections are made
            $("#UniversityDropdown").change(function () {
                var universityId = $(this).val();
                $("#UniversityID").val(universityId);
                if (universityId) {
                    $.get("/Account/GetColleges", { universityId: universityId }, function (colleges) {
                        $("#CollegeDropdown").empty().append('<option value="">Select College</option>');
                        $.each(colleges, function (index, college) {
                            $("#CollegeDropdown").append('<option value="' + college.id + '">' + college.name + '</option>');
                        });
                    });
                }
            });

            $("#CollegeDropdown").change(function () {
                var collegeId = $(this).val();
                $("#CollegeID").val(collegeId);
                if (collegeId) {
                    $.get("/Account/GetBatches", { collegeId: collegeId }, function (batches) {
                        $("#BatchDropdown").empty().append('<option value="">Select Batch</option>');
                        $.each(batches, function (index, batch) {
                            $("#BatchDropdown").append('<option value="' + batch + '">' + batch + '</option>');
                        });
                    });
                }
                });
                $("#BatchDropdown").change(function () {
                     var batch = $(this).val();
                     $("#Batch").val(batch);
                });
                $("form").submit(function () {
                        // Ensure default values are used if nothing is selected
                        if (!$("#UniversityID").val()) $("#UniversityID").val("@Model.UniversityID");
                        if (!$("#CollegeID").val()) $("#CollegeID").val("@Model.CollegeID");
                        if (!$("#Batch").val()) $("#Batch").val("@Model.batch");
                    });

                $("#imgUpload").change(function () {
                var reader = new FileReader();
                reader.onload = function (e) {
                    $("#previewImg").attr("src", e.target.result);
                    $("#previewSection").fadeIn();
                };
                reader.readAsDataURL(this.files[0]);
            });
        });
    </script>
</body>
</html>
